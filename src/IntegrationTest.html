<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>IntegrationTest</title>
    <link rel="stylesheet" href="css/qunit-1.13.0.css">
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture"></div>
<script src="js/external/qunit-1.13.0.js"></script>
<script src="js/QUnitCommon.js"></script>
<script src="js/component/ComponentRepository.js"></script>
<script src="js/component/AbstractionProxy.js"></script>
<script src="js/component/Control.js"></script>
<script src="js/net/HttpClient.js"></script>
<script src="js/view/2_Presentation.js"></script>
<script src="js/view/4_TransitionManager.js"></script>
<script src="js/view/5_Widget.js"></script>
<script src="js/common/Id.js"></script>
<script src="js/common/Assert.js"></script>
<script>

    asyncTest("test-transition", function() {
        var masterRepository = ComponentRepository.create("repository1");

        // define widgets
        masterRepository.addFactory("widget1", function(id, elem, repository) {
            var widget1 = Widget.create(id, elem, repository);
            widget1
            .defineComponents({
                "model1": function() {
                        var reqResMap = {};
                        reqResMap[Id.start()] = Id.load();
                        return AbstractionProxy.create("model1", reqResMap, "contents");
                },
                "view1": function(id, elem) { return Presentation.create(elem.querySelector(".control1"), id);} })
            .defineControls({
                "control1": function(id, widget) { return Control.create("control1", widget, this.get("view1", widget.elem), this.get("model1")); } });

            return widget1;
        });

        var transitionManager = TransitionManager.create(
            document.querySelector("#test-transition"),
            masterRepository);

        transitionManager.transit("widget1");
        setTimeout(function() {
            equal(document.getElementById("test-transition").innerHTML,
                    '<div id="widget1" style="display: block; "><div class="control1"></div></div>');
            start();
        }, 500);
    });

</script>
<div id="test-transition"></div>
</body>
</html>